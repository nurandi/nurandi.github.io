---
title: Grafik Workout Strava dengan ggplot2 dan plotly
author: Nur Andi Setiabudi
date: '2023-11-28'
slug: grafik-workout-strava-dengan-ggplot2-dan-plotly
categories:
  - r
  - visualization
tags:
  - r
  - ggplot2
  - plotly
  - strava
draft: true
---



Sebagai pelari, salah satu grafik favorit saya di Strava adalah *workout analysis* yang sangat berguna untuk mengevaluasi latihan kecepatan, seperti interval, tempo, *fartlek* dan sejenisnya. Grafik ini sebetulnya adalah diagram batang atau *bar chart* yang menampilkan *pace* (menit per kilometer) untuk setiap *split*/*lap*. Hanya saja, *bar chart* ini sedikit dimodifikasi sedemikian rupa, lebar dari batang bervariasi sesuai dengan panjang/pendeknya *split* (berdasarkan waktu atau jarak). Contohnya *workout analysis* dari salah satu [latihan](https://www.strava.com/activities/3197482313) dengan menu:

- 20 menit *warming-up*
- 18x 1 menit pada *pace* 5k dengan 1 menit *recovery*
- 3 menit *recovery*
- 10 menit tempo
- *cooling-down*

*Workout* tersebut digambarkan sangat apik oleh [Strava](https://www.strava.com/activities/3197482313/pace-analysis):

![Strava](index_files/figure-html/strava.png)

Saya tertarik membuat replikasi grafik tersebut menggunakan R dengan memanfaatkan paket populer `ggplot2` yang dipadukan dengan `plotly` agar menjadi interaktif. Karena Strava tidak menyediakan, saya *download* [*dataset*-nya](data/split.csv) dari Garmin Connect. Kebetulan saya menggunakan jam Garmin untuk merekam latihan saat itu.  


```r
library(tidyverse)
```


```r
split <- read.csv("data/split.csv")
head(split)
```

```
##   Laps  Time Distance
## 1    1 20:34     3.42
## 2    2  1:00     0.23
## 3    3  1:00     0.12
## 4    4  1:00     0.24
## 5    5  1:00     0.11
## 6    6  1:00     0.24
```


```r
split <- read.csv("data/split.csv")
head(split)
```

```
##   Laps  Time Distance
## 1    1 20:34     3.42
## 2    2  1:00     0.23
## 3    3  1:00     0.12
## 4    4  1:00     0.24
## 5    5  1:00     0.11
## 6    6  1:00     0.24
```


```r
library(dplyr)
library(lubridate)

split <- split %>%
  arrange(Laps) %>%
  mutate(Time_sec = period_to_seconds(ms(Time)),
         Cumulative_time = cumsum(Time_sec),
         Start_time = Cumulative_time - Time_sec,
         Pace = Time_sec /Distance,
         Base_pace = max(Pace) + 30 )

split
```

```
##    Laps    Time Distance Time_sec Cumulative_time Start_time     Pace Base_pace
## 1     1   20:34     3.42   1234.0          1234.0        0.0 360.8187  575.4545
## 2     2    1:00     0.23     60.0          1294.0     1234.0 260.8696  575.4545
## 3     3    1:00     0.12     60.0          1354.0     1294.0 500.0000  575.4545
## 4     4    1:00     0.24     60.0          1414.0     1354.0 250.0000  575.4545
## 5     5    1:00     0.11     60.0          1474.0     1414.0 545.4545  575.4545
## 6     6    1:00     0.24     60.0          1534.0     1474.0 250.0000  575.4545
## 7     7    1:00     0.11     60.0          1594.0     1534.0 545.4545  575.4545
## 8     8    1:00     0.24     60.0          1654.0     1594.0 250.0000  575.4545
## 9     9    1:00     0.11     60.0          1714.0     1654.0 545.4545  575.4545
## 10   10    1:00     0.25     60.0          1774.0     1714.0 240.0000  575.4545
## 11   11    1:00     0.11     60.0          1834.0     1774.0 545.4545  575.4545
## 12   12    1:00     0.24     60.0          1894.0     1834.0 250.0000  575.4545
## 13   13    1:00     0.12     60.0          1954.0     1894.0 500.0000  575.4545
## 14   14    1:00     0.24     60.0          2014.0     1954.0 250.0000  575.4545
## 15   15    1:00     0.11     60.0          2074.0     2014.0 545.4545  575.4545
## 16   16    1:00     0.24     60.0          2134.0     2074.0 250.0000  575.4545
## 17   17    1:00     0.12     60.0          2194.0     2134.0 500.0000  575.4545
## 18   18    1:00     0.24     60.0          2254.0     2194.0 250.0000  575.4545
## 19   19    1:00     0.12     60.0          2314.0     2254.0 500.0000  575.4545
## 20   20    1:00     0.25     60.0          2374.0     2314.0 240.0000  575.4545
## 21   21    1:00     0.11     60.0          2434.0     2374.0 545.4545  575.4545
## 22   22    1:00     0.24     60.0          2494.0     2434.0 250.0000  575.4545
## 23   23    1:00     0.12     60.0          2554.0     2494.0 500.0000  575.4545
## 24   24    1:00     0.25     60.0          2614.0     2554.0 240.0000  575.4545
## 25   25    1:00     0.12     60.0          2674.0     2614.0 500.0000  575.4545
## 26   26    1:00     0.24     60.0          2734.0     2674.0 250.0000  575.4545
## 27   27    1:00     0.11     60.0          2794.0     2734.0 545.4545  575.4545
## 28   28    1:00     0.24     60.0          2854.0     2794.0 250.0000  575.4545
## 29   29    1:00     0.12     60.0          2914.0     2854.0 500.0000  575.4545
## 30   30    1:00     0.25     60.0          2974.0     2914.0 240.0000  575.4545
## 31   31    1:00     0.11     60.0          3034.0     2974.0 545.4545  575.4545
## 32   32    1:00     0.24     60.0          3094.0     3034.0 250.0000  575.4545
## 33   33    1:00     0.11     60.0          3154.0     3094.0 545.4545  575.4545
## 34   34    1:00     0.25     60.0          3214.0     3154.0 240.0000  575.4545
## 35   35    1:00     0.12     60.0          3274.0     3214.0 500.0000  575.4545
## 36   36    1:00     0.25     60.0          3334.0     3274.0 240.0000  575.4545
## 37   37 03:02.1     0.35    182.1          3516.1     3334.0 520.2857  575.4545
## 38   38   10:02     2.15    602.0          4118.1     3516.1 280.0000  575.4545
## 39   39   21:28     3.67   1288.0          5406.1     4118.1 350.9537  575.4545
```


```r
library(ggplot2)

p <- ggplot(split, aes(label=Distance, label1=Time, label2=Pace)) +
  geom_rect(
    aes(xmin=Start_time, xmax=Cumulative_time,
        ymin=as_datetime(Pace), ymax=as_datetime(Base_pace), 
        fill=Pace), 
    colour="white") +
  scale_y_time(labels = function(t) strftime(t, "%M:%S"))  +
 # scale_x_continuous(labels = split$Laps)  +
  xlab("Distance (km)") +
  ylab("Pace (minutes/km)") +
  labs(title = "Running Analysis: 18 x 1 minute 5k pace + 10 minutes tempo") +
  theme(legend.position='none')
p
```

<img src="index_files/figure-html/unnamed-chunk-5-1.png" width="672" />


```r
library(plotly)
ggplotly(p, tooltip = c("label", "label1", "label2"))
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8d63b1d12df2cdcb36a2" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-8d63b1d12df2cdcb36a2">{"x":{"data":[{"x":[1714,1714,1774,1774,1714,null,2314,2314,2374,2374,2314,null,2554,2554,2614,2614,2554,null,2914,2914,2974,2974,2914,null,3154,3154,3214,3214,3154,null,3274,3274,3334,3334,3274],"y":[240,575.4545454545455,575.4545454545455,240,240,null,240,575.4545454545455,575.4545454545455,240,240,null,240,575.4545454545455,575.4545454545455,240,240,null,240,575.4545454545455,575.4545454545455,240,240,null,240,575.4545454545455,575.4545454545455,240,240,null,240,575.4545454545455,575.4545454545455,240,240],"text":"Distance: 0.25<br />Time: 1:00<br />Pace: 240.0000","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(19,43,67,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1354,1354,1414,1414,1354,null,1474,1474,1534,1534,1474,null,1594,1594,1654,1654,1594,null,1834,1834,1894,1894,1834,null,1954,1954,2014,2014,1954,null,2074,2074,2134,2134,2074,null,2194,2194,2254,2254,2194,null,2434,2434,2494,2494,2434,null,2674,2674,2734,2734,2674,null,2794,2794,2854,2854,2794,null,3034,3034,3094,3094,3034],"y":[250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250,null,250,575.4545454545455,575.4545454545455,250,250],"text":"Distance: 0.24<br />Time: 1:00<br />Pace: 250.0000","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(21,47,72,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1234,1234,1294,1294,1234],"y":[260.86956521739131,575.4545454545455,575.4545454545455,260.86956521739131,260.86956521739131],"text":"Distance: 0.23<br />Time: 1:00<br />Pace: 260.8696","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(23,51,78,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3516.1000000000004,3516.1000000000004,4118.1000000000004,4118.1000000000004,3516.1000000000004],"y":[280,575.4545454545455,575.4545454545455,280,280],"text":"Distance: 2.15<br />Time: 10:02<br />Pace: 280.0000","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(27,59,88,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[4118.1000000000004,4118.1000000000004,5406.1000000000004,5406.1000000000004,4118.1000000000004],"y":[350.95367847411444,575.4545454545455,575.4545454545455,350.95367847411444,350.95367847411444],"text":"Distance: 3.67<br />Time: 21:28<br />Pace: 350.9537","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(42,88,128,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,0,1234,1234,0],"y":[360.81871345029242,575.4545454545455,575.4545454545455,360.81871345029242,360.81871345029242],"text":"Distance: 3.42<br />Time: 20:34<br />Pace: 360.8187","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(44,92,133,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1294,1294,1354,1354,1294,null,1894,1894,1954,1954,1894,null,2134,2134,2194,2194,2134,null,2254,2254,2314,2314,2254,null,2494,2494,2554,2554,2494,null,2614,2614,2674,2674,2614,null,2854,2854,2914,2914,2854,null,3214,3214,3274,3274,3214],"y":[500,575.4545454545455,575.4545454545455,500,500,null,500,575.4545454545455,575.4545454545455,500,500,null,500,575.4545454545455,575.4545454545455,500,500,null,500,575.4545454545455,575.4545454545455,500,500,null,500,575.4545454545455,575.4545454545455,500,500,null,500,575.4545454545455,575.4545454545455,500,500,null,500,575.4545454545455,575.4545454545455,500,500,null,500,575.4545454545455,575.4545454545455,500,500],"text":"Distance: 0.12<br />Time: 1:00<br />Pace: 500.0000","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(75,155,218,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3334,3334,3516.0999999999999,3516.0999999999999,3334],"y":[520.28571428571433,575.4545454545455,575.4545454545455,520.28571428571433,520.28571428571433],"text":"Distance: 0.35<br />Time: 03:02.1<br />Pace: 520.2857","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(80,165,231,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1414,1414,1474,1474,1414,null,1534,1534,1594,1594,1534,null,1654,1654,1714,1714,1654,null,1774,1774,1834,1834,1774,null,2014,2014,2074,2074,2014,null,2374,2374,2434,2434,2374,null,2734,2734,2794,2794,2734,null,2974,2974,3034,3034,2974,null,3094,3094,3154,3154,3094],"y":[545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455,null,545.4545454545455,575.4545454545455,575.4545454545455,545.4545454545455,545.4545454545455],"text":"Distance: 0.11<br />Time: 1:00<br />Pace: 545.4545","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,255,255,1)","dash":"solid"},"fill":"toself","fillcolor":"rgba(86,177,247,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":54.794520547945211},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Running Analysis: 18 x 1 minute 5k pace + 10 minutes tempo","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-270.30500000000001,5676.4050000000007],"tickmode":"array","ticktext":["0","2000","4000"],"tickvals":[0,1999.9999999999998,4000.0000000000005],"categoryorder":"array","categoryarray":["0","2000","4000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Distance (km)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[223.22727272727272,592.22727272727275],"tickmode":"array","ticktext":["04:00","06:00","08:00"],"tickvals":[240,360,480],"categoryorder":"array","categoryarray":["04:00","06:00","08:00"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Pace (minutes/km)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"11887d0597a":{"label":{},"label1":{},"label2":{},"xmin":{},"xmax":{},"ymin":{},"ymax":{},"fill":{},"type":"scatter"}},"cur_data":"11887d0597a","visdat":{"11887d0597a":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```





